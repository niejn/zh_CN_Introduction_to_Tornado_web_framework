#第一章

__引入__

__Introduction__

过去5年中，web开发者可用的工具有飞速成长。随着技术不断推动用户在任何地点都能用上的web应用限制，我们（web开发者）就不得不升级工具包(toolkit), 并创建出那些可用于建立更好的应用的架构（framework）。对于那些可以帮助我们写出__干净、易维护代码__，且在__面向全球用户部署时能够有效调度（scales）__的新的工具包，我们总会趋之若骛。

基于这些理由，我们就要谈谈Tornado了，在写__强大web应用__时，Tornado是一种很棒的选择, __可以简单地创建、扩展及部署应用__。我们仨（原作者）都因为她的__速度、简洁明了及可伸缩性__而爱上了她，并在几个个人项目上进行尝试后，将其纳入到日常工作中。我们已经看到她__在大小项目上对开发者速度的提升__（随之而来的幸福度！），同时项目在时间上令人印象深刻，而同时有着鲁棒性和轻量内存足迹（robustness and lightweight footprint）。

本书的原意，是Tornado web服务器的一个概览，将带着读者贯通此架构的所有基础知识，附有一些样例应用，及在实际中的最佳实践。我们将使用一些例子来详细介绍Tornado是如何工作的，你能用她来做些什么事，以及在使用她来构建第一个应用时要避免的东西。

在本书中，我们假定你__对Python至少有一个粗浅掌握__，知道一点__web服务（web services）运作原理__，及对__数据库基本是熟悉的__。对于任何一点，都有一些很好的参考书（包括_Learning Python_, _Restful Web Services_以及_MongoDB: The Definitive Guide_）。

有了这些，你就可以进行下去了，本书中的示例代码在[Github](https://github.com/Introduction-to-Tornado)上。如你对这些示例或其它内容有任何想法，我们都乐意倾听。

那还等什么，我们开始学习吧！

##Tornado是什么？

Tornado是__一个强大的、具备伸缩性的、以python写就的web服务器__（a powerful, scalable web server written in Python）。__用来处理严酷流量，她足够鲁棒，而她的设置及用来写代码，则是十分轻量的__，而__能够用在种种应用及小工具程序中__。

我们现在知道的Tornado，是基于由FriendFeed公司的Bret Taylor和其他人最初所开发的一个web服务器框架，在Facebook后来收购了FriendFeed公司后所开源出来。与传统那些web服务器最高10k并发连接处理能力不同，Tornado在编写时就将性能纳入考量，以解决C10K问题作为目标，所以在设计上她就__是一个极端高性能架构__（by design it's an extremely high-performance framework）。她还带有__安全及用户认证、社交网络工具__，及__与诸如数据库及webAPIs等外部服务交互的异步__工具。

> __关于C10K问题的背景知识__ 像Apache这样的基于线程的服务器, 为所有进入连接维护着一个操作系统线程池（Thread-based servers like Apache maintain a pool of OS threads for incoming connections）。Apache为每个HTTP连接都分配一个线程，在所有现存线程都繁忙时，就会生成一个新线程，这样才能有更多可用内存。尽管各个系统之间有所不同，但绝大部分的Linux发行版的默认线程堆栈大小是8MB。在负载下，Apache的架构就变得不可预期，而维护着这些打开着的连接的巨大线程池，所有等待数据的打开的连接，很容易耗尽服务器的所有空闲可用内存。

> 绝大部分社交应用都会显示新消息、状态变化及用户通知的实时更新，这就要求客户端保持等待服务器响应的连接一直开着。这些HTTP keep-alive或Comet请求，会迅速令到Apache的最大线程池饱和。而一旦线程池为可用workers充满，服务器就无法回应新请求了（Once the thread pool is depleted of available workers, the server is unable to respond to new requests）。

> 异步服务器对此种场景来说是相对新的，而他们正是设计用于减缓那些基于线程的web服务器局限之处（asynchronous servers are relatively new to the scene, but they are designed to alleviate the limitations of thread-based web servers）。诸如Node.js、lighttpd及Tornado这样的服务器，在负载增长时，采用协同多任务来优雅地完成调度（use cooperative multitasking to scale gracefully as load increases）。也就是说，在当前请求正处于等待来自另一数据源（比如一条数据库查询或HTTP请求）的数据中时，异步服务器将显式地将控制权转交给等待中的请求。而异步服务器用于恢复执行某个上述被暂定操作的__一种常见模式，就是在该被暂停操作所需的恰当数据可用时，调用相应回调函数（invoke callbacks）__。本书第5章中，讨论了该回调函数模式（the callback pattern）, 以及用到Tornado异步特性的几个应用。

自2009年11月10号其发布以来，Tornado就获得大量社区支持，并被应用在许多不同目的。除了FriendFeed和Facebook，多家公司都在生产中转向Tornado，包括Quora、Turntable.fm、Bit.ly、Hipmunk及MyYearbook等都还只是能说出名字少数几家。

简而言之，如正在寻求一种取代现有巨大CMS或那种大一統的开发框架，那么Tornado可能并不适合。Tornado不要求以特定方式建立的巨大模型，或以固定方式处理表单，或是任何类似的东西。她真正做的，就是令到开发者快速而轻易地写出超快的web应用。如你想要利用Python的威力和简单，构建一个可伸缩社交应用、一个实时分析引擎，或者RESTful API，那么Tornado就是理想之选。

###Tornado入门

__Getting Starte with Tornado__

在类Unix系统上安装Tornado都很简单--既可以从PyPI（通过`eays_install`或`pip`进行安装），或者从Github上下载源码让后像这样构建出来。

```
$git clone git@github.com:facebook/tornado
$cd tornado
$python setup.py build
$sudo python setup.py install
```

官方没有给出在Windows系统上的支持，但可通过ActionPython的PyPM包管理软件进行安装。

`c:\pym install tornado`

一旦在机器上安装好Tornado，就可以开始玩了！软件包中有很多演示，包括建立博客、与Facebook集成、运行一个聊天服务器等示例。本书中会一步步演练一些实例应用，但一定要看看那些软件包中带着的示例程序以作参考。

